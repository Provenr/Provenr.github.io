<!DOCTYPE html>
<html lang="zh-CN">


<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>
    vue mock服务 | Provenr
  </title>
  <meta name="description" content="没有比脚更长的路，走过去，前面是春天！">
  
  <meta name="keywords" content="
  vue,mock
  ">
  
  <meta name="author" content="Provenr">

  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta name="theme-color" content="#1e2327">
  <link rel="apple-touch-icon" href="https://github.githubassets.com/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://github.githubassets.com/apple-touch-icon-180x180.png">

  <link rel="icon" type="image/x-icon" href="http://www.provenr.cn/favicon.ico">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  

  
<script>
  var _hmt = _hmt || [];
  (function(){var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?e56a1706ae9d773852a4a03368b51f86";
    var s = document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm, s);})();
</script>


  <script src="//cdnjs.cloudflare.com/ajax/libs/vue/1.0.25-csp/vue.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.min.js"></script>
</head>

<body id="replica-app">

<nav class="navbar-wrapper">
  <div class="navbar">
    <div class="container clearfix">
      <a href="/" class="navbar-logo"><i class="fa fa-github"></i></a>

      <div class="navbar-search float-left desktop-only">
        <div class="navbar-search-form">
          <label for="gsc-i-id1">This website</label>
          <div id="google-search">
            <gcse:search></gcse:search>
          </div>
        </div>
      </div>

      <ul class="navbar-nav float-left">
        
        <li><a href="/archives">Archives</a></li>
        
        
        <li><a href="/categories">Categories</a></li>
        
        
        <li><a href="/tags">Tags</a></li>
        
        
        <li class="desktop-only"><a href="/atom.xml" target="_blank">RSS</a></li>
        
      </ul>

      <ul class="navbar-nav user-nav float-right desktop-only">
        <li class="user-nav-notification">
          <a><span class="user-nav-unread"></span><i class="fa fa-bell"></i></a>
        </li>
        <li>
          <a><i class="fa fa-plus"></i> <i class="fa fa-caret-down"></i></a>
        </li>
        <li class="user-nav-logo">
          <a><img src="/avatar/provenr.jpg"> <i class="fa fa-caret-down"></i></i></a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="main-container">
  <header class="header-wrapper desktop-only">
  <div class="container header-site-detail">
    <ul class="header-toolbar">
      <li class="clearfix">
        <a href="/archives" class="header-toolbar-left"><i
                  class="fa fa-file-text"></i> Posts </a>
        <a href="/archives"
           class="header-toolbar-right"> 26 </a>
      </li>
      <li>
        <a href="/tags" class="header-toolbar-left"><i
                  class="fa fa-tags"></i> Tags </a>
        <a href="/tags"
           class="header-toolbar-right"> 36 </a>
      </li>
      <li>
        <a href="/categories" class="header-toolbar-left"><i
                  class="fa fa-folder-open"></i> Categories </a>
        <a href="/categories"
           class="header-toolbar-right"> 13 </a>
      </li>
    </ul>
    <h2 class="header-title">
      <i class="fa fa-book text-muted"></i>
      <a href="/">Provenr</a>
      
      
    </h2>
  </div>

  <div class="container">
    <div class="header-tab-wrapper clearfix">
      <span class="header-tab header-tab-selected"><i class="fa fa-thumbs-o-up"></i> Like</span>
      <span class="header-tab"><i class="fa fa-share-alt"></i> Share</span>
      <span class="header-tab"><i class="fa fa-comments-o"></i> Discussion</span>
      <span class="header-tab"><i class="fa fa-bookmark-o"></i> Bookmark </span>
      <span class="header-tab"><i class="fa fa-smile-o"></i> Smile <i class="fa fa-caret-down"></i></span>
    </div>
  </div>
</header>

<aside class="side-container desktop-only">
    
        <div id="toc">
            <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-在项目入口文件中直接引入配置好的mock文件"><span class="toc-text">1. 在项目入口文件中直接引入配置好的mock文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-配合express启一个服务"><span class="toc-text">2. 配合express启一个服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#javascript中的require、import和export"><span class="toc-text">javascript中的require、import和export</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#require时代"><span class="toc-text">require时代</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-原始写法"><span class="toc-text">1. 原始写法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-对象写法"><span class="toc-text">2. 对象写法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-立即执行函数写法"><span class="toc-text">3. 立即执行函数写法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AMD是”Asynchronous-Module-Definition”"><span class="toc-text">AMD是”Asynchronous Module Definition”</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-定义模块"><span class="toc-text">1. 定义模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-加载模块"><span class="toc-text">2. 加载模块</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CMD规范-（Common-Module-Definition）"><span class="toc-text">CMD规范 （Common Module Definition）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CMD与AMD区别"><span class="toc-text">CMD与AMD区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ES6标准"><span class="toc-text">ES6标准</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#export导出模块-import引入模块"><span class="toc-text">export导出模块/ import引入模块</span></a></li></ol></li></ol>
        </div>
    
</aside>


<div class="post-container container">
  <h3>
    <i class="fa fa-user-o"></i>
    Provenr

    <span class="post-date float-right" title="{{moment(1560712965000).format('MMM DD, YYYY, h:mm:ss A')}}">
      <i class="fa fa-pencil-square-o"></i>
<!--      {{moment(1560712965000).fromNow()}}-->
      last modified: {{moment(1560712965000).fromNow()}}
    </span>
  </h3>

  <article class="post-content">
    <h1>vue mock服务</h1>
    <p>使用mockjs的有两种方式</p>
<h3 id="1-在项目入口文件中直接引入配置好的mock文件"><a href="#1-在项目入口文件中直接引入配置好的mock文件" class="headerlink" title="1. 在项目入口文件中直接引入配置好的mock文件"></a>1. 在项目入口文件中直接引入配置好的mock文件</h3><ol>
<li>需要在项目内引入mock并创建相关配置文件</li>
<li>直接拦截请求，NetWork看不到请求</li>
<li>调用真实接口时，需要删除相关配置文件。</li>
</ol>
<p>第一步：安装mockjs</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 安装</span><br><span class="line">npm install mockjs -d</span><br></pre></td></tr></table></figure>

<p>第二步：在项目src 目录下新建如下图mock文件夹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">├── src</span><br><span class="line">│   ├── mock</span><br><span class="line">│   	├── userInfo.js          // 用户的mock数据配置</span><br><span class="line">│   	├── index.js            // 模块整合导出Mock</span><br></pre></td></tr></table></figure>

<p>1) index.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import Mock from &apos;mockjs&apos;</span><br><span class="line">import userInfoAPI from &apos;./userInfo&apos;</span><br><span class="line"></span><br><span class="line">Mock.setup(&#123;</span><br><span class="line">  timeout: &apos;200-600&apos;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">//  get 方法 可能传参数 拼接到链接后面，采用正则匹配去拦截请求</span><br><span class="line">Mock.mock(/phpApi\/user\/userinfo(|\?\S*)$/, &apos;get&apos;, userInfoAPI.getUserInfo)</span><br><span class="line"></span><br><span class="line">export default Mock</span><br></pre></td></tr></table></figure>

<p>2）userInfo.js<br> 详细使用方法参考上面<a href="http://mockjs.com/" target="_blank" rel="noopener">mock 官网</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">import Mock from &apos;mockjs&apos; // 获取random对象，随机生成各种数据，具体请翻阅文档</span><br><span class="line">const Random = Mock.Random</span><br><span class="line">const list = [] // 用于存放数据的数组</span><br><span class="line">const code = 200 状态码</span><br><span class="line">for (let i = 0; i &lt; 10; i++) &#123;</span><br><span class="line">  let item = Mock.mock(</span><br><span class="line">    &#123;</span><br><span class="line">      id: &apos;@id&apos;,</span><br><span class="line">      title: Random.csentence(10, 25), // 随机生成长度为10-25的标题</span><br><span class="line">      img: &quot;@image(&apos;200x200&apos;,&apos;red&apos;,&apos;#fff&apos;,&apos;img&apos;)&quot;,</span><br><span class="line">      description: &apos;@paragraph&apos;,</span><br><span class="line">      icon: Random.dataImage(&apos;250x250&apos;, &apos;文章icon&apos;), // 随机生成大小为250x250的图片链接</span><br><span class="line">      date: Random.date() + &apos; &apos; + Random.time() // 随机生成年月日 + 时间</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">  list.push(item)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const userinfo = Mock.mock(&#123;</span><br><span class="line">  id: &apos;@id&apos;,</span><br><span class="line">  email: &apos;@email&apos;,</span><br><span class="line">  ip: &apos;@ip&apos;,</span><br><span class="line">  author: Random.cname(), // 随机生成名字</span><br><span class="line">  avtor: &quot;@image(&apos;200x200&apos;,&apos;red&apos;,&apos;#fff&apos;,&apos;img&apos;)&quot;</span><br><span class="line">&#125;)</span><br><span class="line">// 返回状态码和用户数据</span><br><span class="line">export default &#123;</span><br><span class="line"> getUserInfo: () =&gt; &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      code,</span><br><span class="line">      list: userinfo // list： axios 接口请求拦截这么配置，可以根据自己情况配置</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第三步：项目主入口main.js引入mock</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &apos;./mock&apos;</span><br></pre></td></tr></table></figure>

<p>第四步：axios 封装 <a href="https://www.kancloud.cn/yunye/axios/234845" target="_blank" rel="noopener">axios 官网</a></p>
<p>request.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">import axios from &apos;axios&apos;</span><br><span class="line">import qs from &apos;qs&apos;</span><br><span class="line">import &#123; Toast &#125; from &apos;vant&apos; //请求前loading</span><br><span class="line">import store from &apos;@/store&apos;</span><br><span class="line">import router from &apos;@/router&apos;</span><br><span class="line">// 创建 axios 接口</span><br><span class="line">const service = axios.create(&#123;</span><br><span class="line">  baseURL: process.env.SERVICE_PHP_URL,</span><br><span class="line">  timeout: 10000,</span><br><span class="line">  responseType: &apos;json&apos;,</span><br><span class="line">  headers: &#123;</span><br><span class="line">    &apos;Content-Type&apos;: &apos;application/x-www-form-urlencoded&apos;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// request拦截器</span><br><span class="line">service.interceptors.request.use(config =&gt; &#123;</span><br><span class="line">  Toast.loading(&#123;</span><br><span class="line">    loadingType: &apos;spinner&apos;,</span><br><span class="line">    mask: false,</span><br><span class="line">    duration: 0,</span><br><span class="line">    message: &apos;加载中...&apos;</span><br><span class="line">  &#125;)</span><br><span class="line">  if (config.method !== &apos;get&apos;) &#123;</span><br><span class="line">    if (router.history.current.path !== &apos;/login&apos;) &#123;</span><br><span class="line">      config.params = &#123; &apos;token&apos;: store.getters.token || &apos;&apos; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  config.data = qs.stringify(config.data)</span><br><span class="line">  return config</span><br><span class="line">&#125;, error =&gt; &#123;</span><br><span class="line">  Promise.reject(error)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// respone拦截器</span><br><span class="line">service.interceptors.response.use(response =&gt; &#123;</span><br><span class="line">  let res = response.data</span><br><span class="line">  Toast.clear()</span><br><span class="line">  if (res.code === 200) &#123;</span><br><span class="line">    return res.list</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    Toast(res.msg)</span><br><span class="line">    // 判断登录过期 重定向登录页面</span><br><span class="line">    if (res.code === 209) &#123;</span><br><span class="line">      // store.dispatch(&apos;LogOut&apos;).then(() =&gt; &#123;</span><br><span class="line">      //   this.router.replace(&#123; path: &apos;/login&apos; &#125;)</span><br><span class="line">      // &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return Promise.reject(res.msg)</span><br><span class="line">&#125;, error =&gt; &#123;</span><br><span class="line">  Toast.clear()</span><br><span class="line">  console.log(error)</span><br><span class="line">  return Promise.reject(error)</span><br><span class="line">&#125;)</span><br><span class="line">export function get (url, params = &#123;&#125;, type = true) &#123;</span><br><span class="line">  return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">    if (type) &#123;</span><br><span class="line">      phpService.get(url, &#123;</span><br><span class="line">        params: params</span><br><span class="line">      &#125;).then(response =&gt; &#123;</span><br><span class="line">        resolve(response)</span><br><span class="line">      &#125;)</span><br><span class="line">        .catch(err =&gt; &#123;</span><br><span class="line">          reject(err)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      javaService.get(url, &#123;</span><br><span class="line">        params: params</span><br><span class="line">      &#125;).then(response =&gt; &#123;</span><br><span class="line">        resolve(response)</span><br><span class="line">      &#125;)</span><br><span class="line">        .catch(err =&gt; &#123;</span><br><span class="line">          reject(err)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在src 目录下新建api文件夹对请求接口统一管理</p>
<p>目录结构如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">├── src</span><br><span class="line">│   ├── api</span><br><span class="line">│   	├── user.js     // 用户的</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import &#123; post, get &#125; from &apos;@/utils/request&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 用户信息</span><br><span class="line">export function getUserInfo () &#123;</span><br><span class="line">  return get(&apos;/user/userinfo&apos;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第五步：组件中使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import &#123; getUserInfo &#125; from &apos;@/api/user&apos;</span><br><span class="line"></span><br><span class="line">  getUserInfo().then(function (res) &#123;</span><br><span class="line">      // that.userinfo = res</span><br><span class="line">      console.log(res)</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<p>getUserInfo()请求接口为/user/userinfo，</p>
<p>axios 请求封装时设置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">baseURL: process.env.SERVICE_PHP_URL,</span><br><span class="line"></span><br><span class="line">//process.env.SERVICE_PHP_URL 在config配置文件中为 ‘phpApi’</span><br></pre></td></tr></table></figure>

<p>所以mock 拦截请求的正则匹配</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mock.mock(/phpApi\/user\/userinfo(|\?\S*)$/, &apos;get&apos;, userInfoAPI.getUserInfo)</span><br></pre></td></tr></table></figure>

<p>最终直接返回mock造的假数据。<br><img src="https://note.youdao.com/yws/public/resource/80719707d48b241ad1ae34ab7e29ff67/xmlnote/6BFCC147824D48D39D05749DE1ECD6F3/1987" alt="image"></p>
<h3 id="2-配合express启一个服务"><a href="#2-配合express启一个服务" class="headerlink" title="2. 配合express启一个服务"></a>2. 配合express启一个服务</h3><ol>
<li>模拟了真实的接口，</li>
<li>netWork可以看到请求</li>
<li>不用在项目中做任何配置（正常请求后台接口）</li>
</ol>
<p>第一步：新建service文件夹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm init 初始化</span><br><span class="line"></span><br><span class="line">填写package.json 文件</span><br></pre></td></tr></table></figure>

<p>安装mockjs</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 安装</span><br><span class="line">npm install mockjs -d</span><br><span class="line"></span><br><span class="line"># 安装express</span><br><span class="line">npm install express -d</span><br></pre></td></tr></table></figure>

<p>第二步：在项目src 目录下新建如下图mock文件夹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">│ ├── mock</span><br><span class="line">│  	├── userInfo.js          // 用户的mock数据配置</span><br><span class="line">│  	├── index.js</span><br></pre></td></tr></table></figure>

<p>index.js 文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">// 引入express</span><br><span class="line">const express = require(&apos;express&apos;)</span><br><span class="line">// 引入mock</span><br><span class="line">const Mock = require(&apos;mockjs&apos;)</span><br><span class="line">// 实例化express</span><br><span class="line">const app = express()</span><br><span class="line"></span><br><span class="line">// post请求体相关</span><br><span class="line">// 作用是对post请求的请求体进行解析</span><br><span class="line">let bodyParser = require(&apos;body-parser&apos;)</span><br><span class="line">// mock数据API</span><br><span class="line">let articleAPI = require(&apos;./article&apos;)</span><br><span class="line">app.use(bodyParser.json())</span><br><span class="line"></span><br><span class="line">// 允许跨域</span><br><span class="line">app.all(&apos;*&apos;, function (req, res, next) &#123;</span><br><span class="line">  res.header(&apos;Access-Control-Allow-Origin&apos;, &apos;*&apos;)</span><br><span class="line">  res.header(&apos;Access-Control-Allow-Methods&apos;, &apos;PUT, GET, POST, DELETE, OPTIONS&apos;)</span><br><span class="line">  // 此处根据前端请求携带的请求头进行配置</span><br><span class="line">  res.header(&apos;Access-Control-Allow-Headers&apos;, &apos;X-Requested-With, Content-Type&apos;)</span><br><span class="line">  // 例如： 我们公司的请求头需要携带Authorization和Client-Type，此处就应该按照以下进行配置</span><br><span class="line">  // res.header(&quot;Access-Control-Allow-Headers&quot;, &quot;X-Requested-With, Content-Type, Authorization, Client-Type&quot;);</span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 列表接口</span><br><span class="line">app.get(&apos;/article/list&apos;, function (req, res) &#123;</span><br><span class="line">  res.json(Mock.mock(articleAPI.getList(req)))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(&apos;3000&apos;, () =&gt; &#123;</span><br><span class="line">  console.log(&apos;监听端口 3000&apos;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>article.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">let Mock = require(&apos;mockjs&apos;) // 引入mock</span><br><span class="line">let param2Obj = require(&apos;./tool&apos;)</span><br><span class="line"></span><br><span class="line">const List = []</span><br><span class="line">const count = 100</span><br><span class="line"></span><br><span class="line">for (let i = 0; i &lt; count; i++) &#123;</span><br><span class="line">  List.push(Mock.mock(&#123;</span><br><span class="line">    id: &apos;@increment&apos;,</span><br><span class="line">    timestamp: +Mock.Random.date(&apos;T&apos;),</span><br><span class="line">    author: &apos;@first&apos;,</span><br><span class="line">    reviewer: &apos;@first&apos;,</span><br><span class="line">    title: &apos;@ctitle(5, 10)&apos;,</span><br><span class="line">    content_short: &apos;我是测试数据&apos;,</span><br><span class="line">    content: &apos;@csentence(10, 25)&apos;,</span><br><span class="line">    forecast: &apos;@float(0, 100, 2, 2)&apos;,</span><br><span class="line">    importance: &apos;@integer(1, 3)&apos;,</span><br><span class="line">    &apos;type|1&apos;: [&apos;CN&apos;, &apos;US&apos;, &apos;JP&apos;, &apos;EU&apos;],</span><br><span class="line">    &apos;status|1&apos;: [&apos;published&apos;, &apos;draft&apos;, &apos;deleted&apos;],</span><br><span class="line">    display_time: &apos;@datetime&apos;,</span><br><span class="line">    comment_disabled: true,</span><br><span class="line">    pageviews: &apos;@integer(300, 5000)&apos;,</span><br><span class="line">    image_uri: &quot;@image(&apos;200x200&apos;,&apos;red&apos;, &apos;#fff&apos;, &apos;图片&apos; )&quot;,</span><br><span class="line">    platforms: [&apos;a-platform&apos;]</span><br><span class="line">  &#125;))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  getList: config =&gt; &#123;</span><br><span class="line">    const &#123; importance, type, title, page = 1, limit = 20, sort &#125; = param2Obj(config.url)</span><br><span class="line"></span><br><span class="line">    let mockList = List.filter(item =&gt; &#123;</span><br><span class="line">      if (importance &amp;&amp; item.importance !== +importance) return false</span><br><span class="line">      if (type &amp;&amp; item.type !== type) return false</span><br><span class="line">      if (title &amp;&amp; item.title.indexOf(title) &lt; 0) return false</span><br><span class="line">      return true</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    if (sort === &apos;-id&apos;) &#123;</span><br><span class="line">      mockList = mockList.reverse()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const pageList = mockList.filter((item, index) =&gt; index &lt; limit * page &amp;&amp; index &gt;= limit * (page - 1))</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">      total: mockList.length,</span><br><span class="line">      items: pageList</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  getPv: () =&gt; (&#123;</span><br><span class="line">    pvData: [&#123; key: &apos;PC&apos;, pv: 1024 &#125;, &#123; key: &apos;mobile&apos;, pv: 1024 &#125;, &#123; key: &apos;ios&apos;, pv: 1024 &#125;, &#123; key: &apos;android&apos;, pv: 1024 &#125;]</span><br><span class="line">  &#125;),</span><br><span class="line">  getArticle: (config) =&gt; &#123;</span><br><span class="line">    const &#123; id &#125; = param2Obj(config.url)</span><br><span class="line">    for (const article of List) &#123;</span><br><span class="line">      if (article.id === +id) &#123;</span><br><span class="line">        return article</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  createArticle: () =&gt; (&#123;</span><br><span class="line">    data: &apos;success&apos;</span><br><span class="line">  &#125;),</span><br><span class="line">  updateArticle: () =&gt; (&#123;</span><br><span class="line">    data: &apos;success&apos;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://juejin.im/post/5bf23603e51d452cf56d2902" target="_blank" rel="noopener">参考链接</a></p>
<blockquote>
<p>tips:<br>express + mock 用node.js 起一个本地服务接口<br>和第一种方式的区别是文件的导入方式由import换成了require</p>
</blockquote>
<h3 id="javascript中的require、import和export"><a href="#javascript中的require、import和export" class="headerlink" title="javascript中的require、import和export"></a>javascript中的require、import和export</h3><h4 id="require时代"><a href="#require时代" class="headerlink" title="require时代"></a>require时代</h4><p>在现有的运行环境中，实现”模块”的效果，</p>
<h5 id="1-原始写法"><a href="#1-原始写法" class="headerlink" title="1. 原始写法"></a>1. 原始写法</h5><p>模块就是实现特定功能的一组方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function m2()&#123;</span><br><span class="line">　//...　　</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-对象写法"><a href="#2-对象写法" class="headerlink" title="2. 对象写法"></a>2. 对象写法</h5><p>可以把模块写成一个对象，所有的模块成员都放到这个对象里面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var module1 = new Object(&#123;</span><br><span class="line">_count : 0,</span><br><span class="line">　m1 : function ()&#123;</span><br><span class="line">　　//...</span><br><span class="line">　&#125;,</span><br><span class="line">　m2 : function ()&#123;</span><br><span class="line">　　//...</span><br><span class="line">　&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">使用的时候，就是调用这个对象的属性</span><br><span class="line">module1.m1();</span><br><span class="line">module._count = 1;</span><br></pre></td></tr></table></figure>

<p>写法会==暴露所有模块成员==，==内部状态可以被外部改写==。比如，外部代码可以直接改变内部计数器的值</p>
<h5 id="3-立即执行函数写法"><a href="#3-立即执行函数写法" class="headerlink" title="3. 立即执行函数写法"></a>3. 立即执行函数写法</h5><p>”立即执行函数”（Immediately-Invoked Function Expression，IIFE），可以达到==不暴露私有成员==</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">var module = (function() &#123;</span><br><span class="line">    var _count = 0;</span><br><span class="line">    var m1 = function() &#123;</span><br><span class="line">        alert(_count)</span><br><span class="line">    &#125;</span><br><span class="line">    var m2 = function() &#123;</span><br><span class="line">        alert(_count + 1)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">        m1: m1,</span><br><span class="line">        m2: m2</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line">// 外部代码无法读取内部的_count变量。</span><br></pre></td></tr></table></figure>

<p>CommonJS中，有一个全局性方法require()，用于加载模块。<br>才有了后面的AMD、CMD 也采用的require方式来引用模块的风格</p>
<blockquote>
<p>服务器端模块以后，大家就想要客户端模块。而且最好两者能够兼容，一个模块不用修改，==在服务器和浏览器都可以运行==。</p>
</blockquote>
<p>但是，由于一个重大的局限，使得CommonJS规范不适用于浏览器环境。还是上一节的代码，如果在浏览器中运行，会有一个很大的问题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var math = require(&apos;math&apos;);</span><br><span class="line">math.add(2, 3);</span><br></pre></td></tr></table></figure>

<p>第二行math.add(2, 3)，在第一行require(‘math’)之后运行，因此必须等math.js加载完成。也就是说，如果加载时间很长，整个应用就会停在那里等。</p>
<p>服务器端: 模块都存放在本地硬盘，可以同步加载完成，待时间就是硬盘的读取时间</p>
<p>客户端：模块都放在服务器端，等待时间取决于网速的快慢，可能要等很长时间，浏览器处于”假死”状态。因此，浏览器端的模块，不能采用”同步加载”（synchronous），只能采用”异步加载”（asynchronous）。这就是AMD规范诞生的背景。</p>
<h3 id="AMD是”Asynchronous-Module-Definition”"><a href="#AMD是”Asynchronous-Module-Definition”" class="headerlink" title="AMD是”Asynchronous Module Definition”"></a>AMD是”Asynchronous Module Definition”</h3><p>==模块==必须采用特定的==define()函数==来定义</p>
<p>模块的加载不影响它后面语句的运行。所有依赖这个模块的语句，都定义在一个回调函数中，等到加载完成之后，这个回调函数才会运行。</p>
<h4 id="1-定义模块"><a href="#1-定义模块" class="headerlink" title="1. 定义模块"></a>1. 定义模块</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">define(id?, dependencies?, factory)</span><br><span class="line"></span><br><span class="line">//id:字符串，模块名称(可选)</span><br><span class="line"></span><br><span class="line">//dependencies: 是我们要载入的依赖模块(可选)，使用相对路径。,注意是数组格式</span><br><span class="line"></span><br><span class="line">//factory: 工厂方法，返回一个模块函数</span><br></pre></td></tr></table></figure>

<ol>
<li><p>不依赖模块，直接定义在define（）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">define(</span><br><span class="line">    function ()&#123;</span><br><span class="line">　　　　var add = function (x,y)&#123;</span><br><span class="line">　　　　　　return x+y;</span><br><span class="line">　　　　&#125;;</span><br><span class="line">　　　　return &#123;</span><br><span class="line">　　　　　　add: add</span><br><span class="line">　　　　&#125;;</span><br><span class="line">　　&#125;</span><br><span class="line">　);</span><br></pre></td></tr></table></figure>
</li>
<li><p>依赖其他模块</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">define([&apos;Lib&apos;], function(Lib)&#123;</span><br><span class="line">　　　　function foo()&#123;</span><br><span class="line">　　　　　　Lib.doSomething();</span><br><span class="line">　　　　&#125;</span><br><span class="line">　　　　return &#123;</span><br><span class="line">　　　　　　foo : foo</span><br><span class="line">　　　　&#125;;</span><br><span class="line">　　&#125;</span><br><span class="line">　);</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="2-加载模块"><a href="#2-加载模块" class="headerlink" title="2. 加载模块"></a>2. 加载模块</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">require([module], callback);</span><br><span class="line"></span><br><span class="line">例如：</span><br><span class="line">require([&apos;math&apos;], function (math) &#123;</span><br><span class="line">　math.add(2, 3);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>AMD比较适合浏览器环境。主要有两个Javascript库实现了AMD规范：require.js和curl.js。</p>
<h3 id="CMD规范-（Common-Module-Definition）"><a href="#CMD规范-（Common-Module-Definition）" class="headerlink" title="CMD规范 （Common Module Definition）"></a>CMD规范 （Common Module Definition）</h3><p>也是采用特定的define()函数来定义,用require方式来引用模块,CMD则是依赖就近，用的时候再require。代表==seajs==</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">define(function(require, exports, module) &#123;</span><br><span class="line">    var clock = require(&apos;clock&apos;);</span><br><span class="line">    clock.start();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="CMD与AMD区别"><a href="#CMD与AMD区别" class="headerlink" title="CMD与AMD区别"></a>CMD与AMD区别</h3><p>二者==皆为异步加载模块==。最大的区别是==对依赖模块的执行时机处理不同==，而不是加载的时机或者方式不同，</p>
<p>AMD依赖前置，js可以方便知道依赖模块是谁，立即加载；</p>
<p>CMD就近依赖，需要使用把模块变为字符串解析一遍才知道依赖了那些模块，这也是很多人诟病CMD的一点，牺牲性能来带来开发的便利性，实际上解析模块用的时间短到可以忽略。</p>
<h3 id="ES6标准"><a href="#ES6标准" class="headerlink" title="ES6标准"></a>ES6标准</h3><blockquote>
<p>export指令导出接口，以import引入模块</p>
</blockquote>
<p>==node模块==中我们依然采用的是==CommonJS规范==，使用r==equire==引入模块，使用==module.exports==导出接口。</p>
<h4 id="export导出模块-import引入模块"><a href="#export导出模块-import引入模块" class="headerlink" title="export导出模块/ import引入模块"></a>export导出模块/ import引入模块</h4><blockquote>
<p>模块导出时，可以指定模块的导出成员。导出成员可以认为是类中的公有对象，而非导出成员可以认为是类中的私有对象：</p>
</blockquote>
<p>命名式导入（名称导入）和默认导入（定义式导入）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// 导出</span><br><span class="line">// d.js</span><br><span class="line">export default function() &#123;&#125;</span><br><span class="line"></span><br><span class="line">// 等效于：</span><br><span class="line">function a() &#123;&#125;;</span><br><span class="line">export &#123;a as default&#125;;</span><br><span class="line"></span><br><span class="line">// 导入</span><br><span class="line">import a from &apos;./d&apos;;</span><br><span class="line"></span><br><span class="line">// 等效于，或者说就是下面这种写法的简写，是同一个意思</span><br><span class="line">import &#123;default as a&#125; from &apos;./d&apos;;</span><br></pre></td></tr></table></figure>

<p>1.每个js文件一创建，都有一个var exports = module.exports = {},使exports和module.exports都指向一个空对象。</p>
<ol start="2">
<li>module.exports和exports所指向的内存地址相同</li>
</ol>

  </article>
</div>


    
<div class="container disqus-container">
  <div id="disqus_thread"></div>
</div>

<script>
  var disqus_config = function() {
    this.page.url = "http://github.provenr.cn/2019/06/16/Vue/vue-mock服务/";
    this.page.identifier = 1560712965;
  };

  (function() {
    var d = document, s = d.createElement('script');
    s.src = 'https://blog-provenr-cn.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>





</div>

<div class="footer-wrapper container">
  <footer class="footer clearfix">
    <div class="clearfix">
    <a href="http://github.provenr.cn" class="footer-logo">
      <i class="fa fa-github"></i>
    </a>
    <ul class="footer-social-link">
      <li>© 2019 Provenr</li>
      <li><a href="http://github.provenr.cn">Home</a></li>
      
      <li><a href="https://provenr.github.io/">Github</a></li>
      
    </ul>
    <div class="footer-theme-info">
      Theme <a href="//github.com/sabrinaluo/hexo-theme-replica">Replica</a>
      by <a href="//github.com/sabrinaluo">Hiitea</a> ❤ Powered by Hexo
    </div>
    </div>
    
  </footer>
</div>




<script src="/js/main.js"></script>

</body>
</html>
